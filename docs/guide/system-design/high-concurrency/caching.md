# ç¼“å­˜ç³»ç»Ÿ

> **AIç”Ÿæˆå£°æ˜**: æœ¬æ–‡æ¡£ç”±AIè¾…åŠ©ç”Ÿæˆï¼Œæ—¨åœ¨æä¾›ç¼“å­˜ç³»ç»Ÿçš„åŸºç¡€çŸ¥è¯†å’Œå®è·µæŒ‡å—ã€‚

## ğŸ¯ å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬ç« èŠ‚çš„å­¦ä¹ ,ä½ å°†èƒ½å¤Ÿ:

- ç†è§£ç¼“å­˜çš„ä½œç”¨å’Œé‡è¦æ€§
- æŒæ¡å¤šçº§ç¼“å­˜æ¶æ„è®¾è®¡
- äº†è§£ç¼“å­˜æ›´æ–°ç­–ç•¥
- å­¦ä¹ ç¼“å­˜é—®é¢˜(ç©¿é€ã€å‡»ç©¿ã€é›ªå´©)çš„è§£å†³æ–¹æ¡ˆ

## ğŸ“š ä»€ä¹ˆæ˜¯ç¼“å­˜

ç¼“å­˜æ˜¯å°†ç»å¸¸è®¿é—®çš„æ•°æ®å­˜å‚¨åœ¨å¿«é€Ÿå­˜å‚¨ä»‹è´¨ä¸­,ä»¥æé«˜æ•°æ®è®¿é—®é€Ÿåº¦çš„æŠ€æœ¯ã€‚

### ç¼“å­˜çš„ä½œç”¨

1. **æå‡æ€§èƒ½**: å‡å°‘æ•°æ®åº“è®¿é—®,é™ä½å“åº”æ—¶é—´
2. **é™ä½è´Ÿè½½**: å‡è½»åç«¯æœåŠ¡å‹åŠ›
3. **æ”¹å–„ä½“éªŒ**: å¿«é€Ÿå“åº”ç”¨æˆ·è¯·æ±‚

### ç¼“å­˜çš„å±‚æ¬¡

- **æµè§ˆå™¨ç¼“å­˜**: é™æ€èµ„æºç¼“å­˜
- **CDNç¼“å­˜**: å°±è¿‘è®¿é—®,é™ä½ç½‘ç»œå»¶è¿Ÿ
- **åå‘ä»£ç†ç¼“å­˜**: Nginxç­‰ä»£ç†å±‚ç¼“å­˜
- **åº”ç”¨ç¼“å­˜**: æœ¬åœ°ç¼“å­˜ã€åˆ†å¸ƒå¼ç¼“å­˜
- **æ•°æ®åº“ç¼“å­˜**: æŸ¥è¯¢ç»“æœç¼“å­˜

## ğŸ—ï¸ ç¼“å­˜æ¶æ„è®¾è®¡

### å¤šçº§ç¼“å­˜æ¶æ„

```
ç”¨æˆ·è¯·æ±‚
  â†“
CDNç¼“å­˜(é™æ€èµ„æº)
  â†“
åå‘ä»£ç†ç¼“å­˜(Nginx)
  â†“
åº”ç”¨æœ¬åœ°ç¼“å­˜(Guava Cache)
  â†“
åˆ†å¸ƒå¼ç¼“å­˜(Redis)
  â†“
æ•°æ®åº“
```

### æœ¬åœ°ç¼“å­˜ vs åˆ†å¸ƒå¼ç¼“å­˜

**æœ¬åœ°ç¼“å­˜**:
- è®¿é—®é€Ÿåº¦å¿«,é›¶ç½‘ç»œå»¶è¿Ÿ
- å†…å­˜å®¹é‡æœ‰é™
- é›†ç¾¤ç¯å¢ƒä¸‹æ•°æ®ä¸åŒæ­¥

**åˆ†å¸ƒå¼ç¼“å­˜**:
- å®¹é‡å¤§,å¯æ‰©å±•
- æ•°æ®ä¸€è‡´æ€§å¥½
- éœ€è¦ç½‘ç»œè®¿é—®,æœ‰å»¶è¿Ÿ

## ğŸ”„ ç¼“å­˜æ›´æ–°ç­–ç•¥

### 1. Cache Aside(æ—è·¯ç¼“å­˜)

**æµç¨‹**:
- è¯»: å…ˆæŸ¥ç¼“å­˜,ç¼“å­˜æœªå‘½ä¸­åˆ™æŸ¥æ•°æ®åº“,ç„¶åå†™å…¥ç¼“å­˜
- å†™: å…ˆæ›´æ–°æ•°æ®åº“,å†åˆ é™¤ç¼“å­˜

**ä¼˜ç‚¹**: ç®€å•,æ•°æ®ä¸€è‡´æ€§å¥½
**ç¼ºç‚¹**: å¯èƒ½å‡ºç°ç¼“å­˜ç©¿é€

### 2. Read/Write Through(è¯»å†™ç©¿é€)

**æµç¨‹**:
- è¯»: ç¼“å­˜æœªå‘½ä¸­æ—¶,ç¼“å­˜æœåŠ¡è´Ÿè´£ä»æ•°æ®åº“åŠ è½½
- å†™: å…ˆæ›´æ–°ç¼“å­˜,å†ç”±ç¼“å­˜æœåŠ¡æ›´æ–°æ•°æ®åº“

**ä¼˜ç‚¹**: ä¸šåŠ¡é€»è¾‘ç®€å•
**ç¼ºç‚¹**: ç¼“å­˜æœåŠ¡å¤æ‚åº¦é«˜

### 3. Write Back(å†™å›)

**æµç¨‹**:
- å†™: åªæ›´æ–°ç¼“å­˜,å¼‚æ­¥æ‰¹é‡å†™å…¥æ•°æ®åº“
- è¯»: ä»ç¼“å­˜è¯»å–

**ä¼˜ç‚¹**: å†™å…¥æ€§èƒ½é«˜
**ç¼ºç‚¹**: æ•°æ®å¯èƒ½ä¸¢å¤±

## âš ï¸ ç¼“å­˜å¸¸è§é—®é¢˜

### 1. ç¼“å­˜ç©¿é€

**é—®é¢˜**: æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®,æ¯æ¬¡éƒ½ç©¿é€åˆ°æ•°æ®åº“

**è§£å†³æ–¹æ¡ˆ**:
- å¸ƒéš†è¿‡æ»¤å™¨: å¿«é€Ÿåˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨
- ç©ºå€¼ç¼“å­˜: å¯¹ä¸å­˜åœ¨çš„æ•°æ®ä¹Ÿç¼“å­˜(è®¾ç½®çŸ­è¿‡æœŸæ—¶é—´)
- å‚æ•°æ ¡éªŒ: åœ¨æ¥å£å±‚åšå‚æ•°æ ¡éªŒ

### 2. ç¼“å­˜å‡»ç©¿

**é—®é¢˜**: çƒ­ç‚¹æ•°æ®è¿‡æœŸ,å¤§é‡è¯·æ±‚åŒæ—¶è®¿é—®æ•°æ®åº“

**è§£å†³æ–¹æ¡ˆ**:
- äº’æ–¥é”: åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æŸ¥è¯¢æ•°æ®åº“
- æ°¸ä¸è¿‡æœŸ: å¼‚æ­¥æ›´æ–°çƒ­ç‚¹æ•°æ®
- å¤šçº§ç¼“å­˜: æœ¬åœ°ç¼“å­˜+åˆ†å¸ƒå¼ç¼“å­˜

### 3. ç¼“å­˜é›ªå´©

**é—®é¢˜**: å¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸ,å¯¼è‡´æ•°æ®åº“å‹åŠ›éª¤å¢

**è§£å†³æ–¹æ¡ˆ**:
- è¿‡æœŸæ—¶é—´éšæœºåŒ–: é¿å…åŒæ—¶è¿‡æœŸ
- ç¼“å­˜é¢„çƒ­: ç³»ç»Ÿå¯åŠ¨æ—¶é¢„åŠ è½½æ•°æ®
- å¤šçº§ç¼“å­˜: é™ä½å½±å“èŒƒå›´
- é™æµé™çº§: ä¿æŠ¤åç«¯æœåŠ¡

## ğŸš€ å®è·µåº”ç”¨

### Redisç¼“å­˜å®ç°

```python
import redis
import json
from functools import wraps

redis_client = redis.Redis(host='localhost', port=6379)

def cache_result(expire=300):
    """ç¼“å­˜è£…é¥°å™¨"""
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            # ç”Ÿæˆç¼“å­˜key
            cache_key = f"{func.__name__}:{args}:{kwargs}"
            
            # å…ˆæŸ¥ç¼“å­˜
            cached = redis_client.get(cache_key)
            if cached:
                return json.loads(cached)
            
            # æŸ¥æ•°æ®åº“
            result = func(*args, **kwargs)
            
            # å†™å…¥ç¼“å­˜
            redis_client.setex(
                cache_key, 
                expire, 
                json.dumps(result)
            )
            
            return result
        return wrapper
    return decorator

# ä½¿ç”¨ç¤ºä¾‹
@cache_result(expire=600)
def get_user_info(user_id):
    # æŸ¥è¯¢æ•°æ®åº“
    return {"id": user_id, "name": "å¼ ä¸‰"}
```

### ç¼“å­˜é¢„çƒ­ç­–ç•¥

```python
def cache_warmup():
    """ç¼“å­˜é¢„çƒ­"""
    # 1. åŠ è½½çƒ­ç‚¹æ•°æ®
    hot_users = get_hot_users()
    for user in hot_users:
        cache_key = f"user:{user.id}"
        redis_client.setex(cache_key, 3600, json.dumps(user))
    
    # 2. åŠ è½½ç»Ÿè®¡æ•°æ®
    stats = calculate_stats()
    redis_client.setex("stats", 1800, json.dumps(stats))
```

### å¸ƒéš†è¿‡æ»¤å™¨é˜²ç©¿é€

```python
from pybloom_live import BloomFilter

# åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨
bf = BloomFilter(capacity=1000000, error_rate=0.001)

# æ•°æ®å†™å…¥æ—¶æ·»åŠ åˆ°å¸ƒéš†è¿‡æ»¤å™¨
def add_user(user_id):
    bf.add(user_id)
    # å†™å…¥æ•°æ®åº“...

# æŸ¥è¯¢æ—¶å…ˆæ£€æŸ¥å¸ƒéš†è¿‡æ»¤å™¨
def get_user(user_id):
    if user_id not in bf:
        return None  # è‚¯å®šä¸å­˜åœ¨
    
    # æŸ¥ç¼“å­˜
    cached = redis_client.get(f"user:{user_id}")
    if cached:
        return json.loads(cached)
    
    # æŸ¥æ•°æ®åº“
    user = query_database(user_id)
    if user:
        redis_client.setex(f"user:{user_id}", 600, json.dumps(user))
    return user
```

## ğŸ“Š ç¼“å­˜ç›‘æ§æŒ‡æ ‡

- **å‘½ä¸­ç‡**: ç¼“å­˜å‘½ä¸­è¯·æ±‚ / æ€»è¯·æ±‚
- **å“åº”æ—¶é—´**: ç¼“å­˜è®¿é—®å»¶è¿Ÿ
- **å†…å­˜ä½¿ç”¨**: ç¼“å­˜å ç”¨å†…å­˜
- **è¿‡æœŸç­–ç•¥**: è¿‡æœŸæ•°æ®æ¸…ç†æƒ…å†µ

## ğŸ“– æ¨èèµ„æº

- [Rediså®˜æ–¹æ–‡æ¡£](https://redis.io/documentation)
- [ç¼“å­˜æ¶æ„è®¾è®¡æœ€ä½³å®è·µ](https://aws.amazon.com/caching/)
- ã€ŠRedisè®¾è®¡ä¸å®ç°ã€‹ä¹¦ç±

## ğŸ’¡ ä¸‹ä¸€æ­¥

- å­¦ä¹ [æ¶ˆæ¯é˜Ÿåˆ—](./message-queue.md)åº”ç”¨
- äº†è§£[æ•°æ®åº“ä¼˜åŒ–](./database-optimization.md)
- æŒæ¡[é™æµä¸ç†”æ–­](./rate-limiting-circuit-breaker.md)

---

*æœ€åæ›´æ–°æ—¶é—´: 2025-01-20*

