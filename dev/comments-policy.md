# 评论内容安全与反滥用策略

## 目标
- 中国可访问；避免违禁词、广告与恶意链接；保护读者免受钓鱼与诈骗。

## 服务端（CloudBase + Twikoo）
- 内容安全（TMS）：开启文本/图片全类目检测；命中直接拦截或进入审核。
- 频率限制：`TWIKOO_THROTTLE_MS=10000`；同 IP/UA 频繁触发则封禁。
- 词库：维护 `TWIKOO_BLOCK_WORDS`（逗号分隔）；每次更新同步本文件。
- 黑/白名单：
  - IP 黑名单：云函数配置或数据库集合维护。
  - 允许域名白名单：评论内容中的 URL 若不在白名单，前端仅以纯文本显示。

## 客户端（前端）
- 链接安全：渲染时对 `a` 标签强制 `rel="nofollow ugc noopener noreferrer"`。
- URL 验证：仅允许 `http/https` 且带主机；否则阻止点击。
- 字数限制：最小 5、最大 1000（与后端一致）。
- 提交冷却：按钮冷却 ≥ 10s（后端为准）。
- 关闭开关：文档页 Frontmatter `comments:false` 可禁用评论。

## 运营流程
- 日常巡检：每周查看异常词频与 IP，更新黑名单与词库。
- 重大事件：如遭遇刷屏/攻击，临时启用验证码或改为“仅登录可评论”。

## 未来扩展
- 微信登录：开启后，记录 `openid` 以便风控与服务拓展（积分、收藏等）。
- GitHub 登录：后续可并存 Waline 或自建 OAuth 网关，统一用户映射策略。
